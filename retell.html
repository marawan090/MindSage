<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>تشغيل Retell Agent داخل الموقع</title>
</head>
<body>
  <h2>Retell Voice Agent</h2>

  <button onclick="startCall()">▶️ بدء الجلسة</button>
  <button onclick="stopCall()">⏹️ إيقاف الجلسة</button>

  <p id="status">⚪ في انتظار التشغيل...</p>

  <!-- تضمين مكتبة SDK -->
  <script src="https://cdn.retellai.com/web-sdk/index.min.js"></script>

  <script>
    // بياناتك الحقيقية
    const agentId = "agent_ac97619bfb93997ccf71cff3d5";
    const apiKey = "key_9d940c8b806dd4757857040e9e74";

    let callId = null;
    let webCall = null;

    async function startCall() {
      document.getElementById("status").innerText = "⏳ جاري إنشاء المكالمة...";

      try {
        const response = await fetch("https://api.retellai.com/v2/create-web-call", {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${apiKey}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            agent_id: agentId
          })
        });

        const data = await response.json();

        if (!data.call_id) {
          document.getElementById("status").innerText = "❌ فشل في إنشاء المكالمة.";
          console.error("API Error:", data);
          return;
        }

        callId = data.call_id;
        webCall = await window.retellWebSDK.joinCall({ callId });

        document.getElementById("status").innerText = "🟢 الجلسة تعمل الآن.";
        console.log("✅ المكالمة بدأت بنجاح");
      } catch (err) {
        document.getElementById("status").innerText = "❌ حدث خطأ أثناء التشغيل.";
        console.error(err);
      }
    }

    async function stopCall() {
      if (webCall) {
        await webCall.leaveCall();
        document.getElementById("status").innerText = "🔴 تم إيقاف الجلسة.";
        console.log("⛔ المكالمة توقفت");
      } else {
        document.getElementById("status").innerText = "⚠️ لا توجد جلسة نشطة حاليًا.";
      }
    }
  </script>
</body>
</html>
